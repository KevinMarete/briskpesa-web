!function(s){function t(e,r,a){s.ajax({url:r,type:"POST",data:{trans_id:e},complete:function(o){if(200!=o.status)console.log("Error occurred "+o.status);else{var n=s.parseJSON(o.responseText);1==n.status?(s("#progress").css("display","none"),s("#paybtn").removeAttr("disabled"),s("#status").css("display","block"),s("#status").html('<div class="alert alert-warning""><strong>Failed!</strong> '+n.desc+"</div>"),a.error(o.responseText)):0==n.status?(s("#progress").css("display","none"),s("#paybtn").removeAttr("disabled"),s("#status").css("display","block"),s("#status").html('<div class="alert alert-success"><strong>Success!</strong> Mpesa receipt number is '+n.mpesa_code+" </div>"),a.success(o.responseText)):setTimeout(t,2e3,e,r,a)}}})}function e(s){var t=new RegExp("^(?:\\+?254)?(0|7|07)\\d{8}$");return t.test(s)}function r(s){return"0"==s[0]?s:"+"==s[0]?"0"+s.substring(4):s.startsWith("254")?"0"+s.substring(3):9==s.length?"0"+s:s}s.fn.briskPesa=function(a){function o(){return p=void 0===a.checkoutUrl?"checkout.php":a.checkoutUrl,v=void 0===a.pollUrl?"poll.php":a.pollUrl,l=void 0===n?s.trim(s("#phone").val()):l,d=void 0===i?s.trim(s("#amount").val()):d,e(l)?0==s.isNumeric(d)?(alert("Enter valid amount"),s("#amount").focus(),!1):parseInt(d)<10?(alert("Amount must be greater than 10"),s("#amount").focus(),!1):(s("#progress").css("display","block"),s("#status").css("display","none"),s("#paybtn").attr("disabled","disabled"),l=r(l),void s.ajax({url:p,type:"POST",data:{phone:l,amount:d},complete:function(e){if(200!=e.status)s("#progress").css("display","none"),s("#paybtn").removeAttr("disabled"),s("#status").css("display","block"),s("#status").html('<div class="alert alert-warning""><strong>Failed!</strong> An error occurred.</div>'),a.error(e.responseText);else{var r=s.parseJSON(e.responseText);0==r.status?(s("#progress").css("display","none"),s("#paybtn").removeAttr("disabled"),s("#status").css("display","block"),s("#status").html('<div class="alert alert-warning""><strong>Failed!</strong> '+r.desc+"</div>"),a.error(e.responseText)):t(r.trans_id,v,a)}}})):(alert("Enter valid phone number"),s("#phone").focus(),!1)}var n=this.data("phone"),i=this.data("amount"),l=this.data("phone"),d=this.data("amount"),u=void 0==a.payButtonText?"Pay":a.payButtonText;this.html(""),this.append('<div id=notification" style="width: 100%"> <div class="progress" id="progress"> <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:100%"> Please wait</div></div><div id="status"></div></div>');var c="<form>";void 0===i&&(c+='<div class="form-group"> <label for="phone" class="control-label">Phone Number</label><input type="hidden" class="form-control" id="download"><input type="text" class="form-control" placeholder="e.g 07xx" id="phone"></div>'),void 0===i&&(c+='<div class="form-group"><label for="amount" class="control-label">Amount</label><input type="number" class="form-control" placeholder="e.g 10" id="amount"></div>'),c+=a.showPayButton===!1?'<div class="form-group" style="display:none;"><button id="paybtn" type="button" class="btn btn-success">'+u+"</button></div></form>":'<div class="form-group"><button id="paybtn" type="button" class="btn btn-success">'+u+"</button></div></form>",this.append(c);var p=null,v=null;return s("#paybtn").click(function(){o()}),s("#progress, #status").css("display","none"),this.requestPayment=function(s){void 0!=s.phone&&(l=s.phone,n=!0),void 0!=s.amount&&(d=s.amount,i=!0),void 0!=s.success&&(a.success=s.success),void 0!=s.error&&(a.error=s.error),o()},this}}(jQuery);
